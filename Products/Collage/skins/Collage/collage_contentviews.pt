<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      lang="en"
      i18n:domain="plone">

<body>
  <metal:add-item-menu define-macro="add-item-list">
    <tal:defines define="addContext   nocall: here;
			 allowedTypes addContext/getAllowedTypes;
			 menuTypes    python:here.getAddableTypesInMenu(allowedTypes);
			 numAllowed   python:len(allowedTypes);
			 numMenu      python:len(menuTypes);
			 showSettings python: 1;
			 showMore     python:numAllowed > numMenu;
			 showMenu     python:showMore or showSettings or numMenu > 1;"
		 condition="python:numAllowed >= 1 or showSettings">
      
      <ul class="collage-content-menu" tal:condition="showMenu">
        <tal:types repeat="ctype menuTypes">
          <li tal:define="Title ctype/Title; Id ctype/getId; Description ctype/Description;
                          item_type_class python: 'visualIcon contenttype-' + normalizeString(Id);"
              tal:attributes="class string:${item_type_class}">
            <a href="#"
	       class="visualIconPadding"
               i18n:attributes="title"
               tal:attributes="href string:${addContext/absolute_url}/createObject?type_name=${Id};
                               title string:$Title: $Description"
	       tal:content="Title">
	      Portal type               
            </a>
          </li>
        </tal:types>
        <li tal:condition="showMore">
          <a href="#" class="folderAddMore" title="Show all available content types"
             i18n:attributes="title title_show_all_content_types;"
             tal:attributes="href string:${addContext/absolute_url}/folder_factories;">
            <tal:title i18n:translate="folder_add_more">
              More&hellip;
            </tal:title>
          </a>
        </li>
        <li class="actionSeparator" tal:condition="showSettings">
          <a href="#" class="folderAddSettings" title="Configure which content types can be added here"
             i18n:attributes="title title_configure_addable_content_types;"
             tal:attributes="href string:${addContext/absolute_url}/folder_constraintypes_form;">
            <tal:title i18n:translate="folder_add_settings">
              Restrict&hellip;
            </tal:title>
          </a>
        </li> 
      </ul>
    </tal:defines>
  </metal:add-item-menu>
  
  <div metal:define-macro="add-item"
       tal:omit-tag=""
       tal:define="plone_view here/@@plone;
		   manage_portal python:checkPermission('Manage portal', here);
		   parent_folder plone_view/getCurrentFolder;
		   create_id here/@@collage_utility/generateCreationID;
		   useSelf python:isStructuralFolder and not isContextDefaultPage;">

    <tal:structuralFolder condition="plone_view/isStructuralFolder">
      <tal:add define="here nocall: parent_folder">
	<metal:add-item-menu use-macro="here/collage_contentviews/macros/add-item-list" />
      </tal:add>
    </tal:structuralFolder>  
  </div>

  <span class="collage-navigation" metal:define-macro="vertical_navigation">
    <a class="collage-js-down" tal:attributes="href string:${base_url}/reorderObject?position=down&id=${here/getId}">
      <img tal:attributes="src string:${portal_url}/arrowDown.gif">
    </a>
    <a class="collage-js-up" tal:attributes="href string:${base_url}/reorderObject?position=up&id=${here/getId}">
      <img tal:attributes="src string:${portal_url}/arrowUp.gif">
    </a>
  </span>

  <span class="collage-navigation" metal:define-macro="horizontal_navigation">
    <a class="collage-js-up" tal:attributes="href string:${base_url}/reorderObject?position=up&id=${here/getId}">
      <img tal:attributes="src string:${portal_url}/arrowLeft.gif">
    </a>
    <a class="collage-js-down" tal:attributes="href string:${base_url}/reorderObject?position=down&id=${here/getId}">
      <img tal:attributes="src string:${portal_url}/arrowRight.gif">
    </a>
  </span>

  <div metal:define-macro="actions"
       tal:omit-tag=""
       tal:define="default_tab default_tab | request/default_tab | string:view;
		   alias python: here.portal_type == 'CollageAlias' and here.get_target();
		   action_object python: alias or here;
		   actions python: here.portal_actions.listFilteredActionsFor(action_object);
		   view_actions python:here.plonifyActions(template_id=template_id, actions=actions, default_tab=default_tab)">
 
    <span class="row-type"
	  tal:condition="not: alias"
	  tal:content="string: ${here/portal_type}:" />

    <span class="row-type"
	  tal:condition="alias"
	  tal:content="string: ${alias/portal_type} (aliased):" />

    <span metal:define-slot="navigation" />
    
    <a class="action"
       tal:attributes="href string:${here/absolute_url}/delete_confirmation">
      <span>Delete</span>
    </a>
    
    <tal:actions repeat="action view_actions">
      <a tal:condition="python: action['id'] not in ['folderContents', 'metadata', 'local_roles', 'revisitCollage', 'portlets']"
         tal:define="selected action/selected|nothing;"
         tal:attributes="id string:contentview-${action/id};
                         class python:'action '+test(selected, 'selected', 'plain');
			 href action/url"
	 i18n:translate="">
	<span tal:content="action/title">
	  View name
	</span>
      </a>
    </tal:actions>
  </div>    

  <div metal:define-macro="layouts"
       tal:omit-tag=""
       tal:define="isAlias python: here.portal_type == 'CollageAlias';
		   layout_object python: isAlias and here.get_target() or here;
		   manage_portal python:checkPermission('Manage portal', layout_object);
		   vocab layout_object/getSelectableViews;
		   selectedLayout python: here.getLayout() or ''"
       condition="python: vocab">
      
    <tal:layouts repeat="layout vocab">
      <a class="layout"
	 tal:define="value python:layout[0];
                     display python:layout[1];"
         tal:attributes="href string:${here/absolute_url}/setViewTemplate?templateId=$value;
                         title display"
         i18n:attributes="title"
         i18n:translate="">
	<span tal:attributes="class python: test(value==selectedLayout, 'active', 'inactive')"
              tal:content="display">
	  Layout name
	</span>
      </a>
    </tal:layouts>
  </div>
  
</body>
</html>
